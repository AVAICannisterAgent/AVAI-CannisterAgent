# Motoko Builder Container
FROM ubuntu:22.04

# Set environment to non-interactive
ENV DEBIAN_FRONTEND=noninteractive
ENV DFX_VERSION=0.22.0

# Install dependencies
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    git \
    build-essential \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Install DFX SDK manually (non-interactive)
RUN mkdir -p /root/.local/share/dfx/bin && \
    curl -fsSL https://github.com/dfinity/sdk/releases/download/${DFX_VERSION}/dfx-${DFX_VERSION}-x86_64-linux.tar.gz | \
    tar -xz -C /root/.local/share/dfx/bin && \
    chmod +x /root/.local/share/dfx/bin/dfx

ENV PATH="/root/.local/share/dfx/bin:$PATH"

# Install vessel
RUN wget https://github.com/dfinity/vessel/releases/download/v0.6.4/vessel-linux64 \
    && chmod +x vessel-linux64 \
    && mv vessel-linux64 /usr/local/bin/vessel

WORKDIR /workspace

# Copy Motoko files
COPY motoko_modules/ ./motoko_modules/
COPY src/ ./src/
COPY dfx.json ./
COPY vessel.dhall ./

# Build command
CMD ["dfx", "build", "--all"]